From 372f8b5fbd2a43d9d6696fc66146a7ca6e9344cc Mon Sep 17 00:00:00 2001
From: Nils Philippsen <nils@redhat.com>
Date: Wed, 18 May 2011 19:08:55 +0200
Subject: [PATCH] patch: CVE-2010-4543,2011-1782

Squashed commit of the following:

commit 00474eaa52470b1d58429290574f098f1a7cf053
Author: Nils Philippsen <nils@redhat.com>
Date:   Fri May 13 17:08:02 2011 +0200

    file-psp: fix overflow protection (CVE-2011-1782)

    amends commit 48ec15890e1751dede061f6d1f469b6508c13439, related to
    CVE-2010-4543
    (cherry picked from commit 831e93b10d76881f019900cb7eba59c80ebbaa3a)

commit 9fed6e41161b9d6bc50b95911c8c97e008f284f1
Author: Simon Budig <simon@budig.de>
Date:   Mon Feb 14 21:46:31 2011 +0100

    file-psp: fix for bogus input data. Fixes bug #639203
    (cherry picked from commit 48ec15890e1751dede061f6d1f469b6508c13439)
---
 plug-ins/common/file-psp.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/plug-ins/common/file-psp.c b/plug-ins/common/file-psp.c
index db12770..4931c87 100644
--- a/plug-ins/common/file-psp.c
+++ b/plug-ins/common/file-psp.c
@@ -1244,6 +1244,10 @@ read_channel_data (FILE       *f,
             }
           else
             fread (buf, runcount, 1, f);
+
+          /* prevent buffer overflow for bogus data */
+          runcount = MIN (runcount, (endq - q) / bytespp);
+
           if (bytespp == 1)
             {
               memmove (q, buf, runcount);
-- 
1.7.5.1

